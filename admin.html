<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Admin Status - LunchNear.me</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-text {
            background: linear-gradient(135deg, #F97316 0%, #EC4899 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #F97316 0%, #EC4899 100%);
        }
        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse-dot {
            animation: pulse-dot 2s ease-in-out infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .spin {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-900 antialiased min-h-screen">

    <!-- Header -->
    <header class="bg-white border-b border-stone-200">
        <div class="max-w-4xl mx-auto px-6 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 gradient-bg rounded-lg flex items-center justify-center">
                    <svg class="w-5 h-5 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"></path>
                        <path d="M7 2v20"></path>
                        <path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3zm0 0v7"></path>
                    </svg>
                </div>
                <div>
                    <h1 class="text-lg font-semibold">LunchNear.me</h1>
                    <p class="text-xs text-stone-500">Admin Status Dashboard</p>
                </div>
            </div>
            <a href="index.html" class="text-sm text-stone-500 hover:text-stone-900 flex items-center gap-1">
                <i data-feather="arrow-left" class="w-4 h-4"></i>
                Back to site
            </a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto px-6 py-8">

        <!-- Overall Status -->
        <div class="bg-white rounded-2xl border border-stone-200 p-6 mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-xl font-semibold mb-1">System Status</h2>
                    <p class="text-sm text-stone-500">Last checked: <span id="last-check">-</span></p>
                </div>
                <div id="overall-status" class="flex items-center gap-2 px-4 py-2 rounded-full bg-stone-100">
                    <div class="w-3 h-3 rounded-full bg-stone-400"></div>
                    <span class="text-sm font-medium text-stone-600">Checking...</span>
                </div>
            </div>
        </div>

        <!-- Services Grid -->
        <div class="grid md:grid-cols-2 gap-4 mb-8">

            <!-- Supabase Database -->
            <div class="bg-white rounded-xl border border-stone-200 p-5" id="card-supabase">
                <div class="flex items-start justify-between mb-4">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-lg bg-emerald-100 flex items-center justify-center text-emerald-600">
                            <i data-feather="database" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <h3 class="font-medium">Supabase</h3>
                            <p class="text-xs text-stone-500">Database & Auth</p>
                        </div>
                    </div>
                    <div id="status-supabase" class="flex items-center gap-1.5">
                        <div class="w-2 h-2 rounded-full bg-stone-300 spin"></div>
                        <span class="text-xs text-stone-500">Checking</span>
                    </div>
                </div>
                <div class="text-xs text-stone-400" id="details-supabase">-</div>
            </div>

            <!-- Google Places API -->
            <div class="bg-white rounded-xl border border-stone-200 p-5" id="card-google">
                <div class="flex items-start justify-between mb-4">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center text-blue-600">
                            <i data-feather="map-pin" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <h3 class="font-medium">Google Places</h3>
                            <p class="text-xs text-stone-500">Restaurant Data</p>
                        </div>
                    </div>
                    <div id="status-google" class="flex items-center gap-1.5">
                        <div class="w-2 h-2 rounded-full bg-stone-300 spin"></div>
                        <span class="text-xs text-stone-500">Checking</span>
                    </div>
                </div>
                <div class="text-xs text-stone-400" id="details-google">-</div>
            </div>

            <!-- Together AI -->
            <div class="bg-white rounded-xl border border-stone-200 p-5" id="card-ai">
                <div class="flex items-start justify-between mb-4">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center text-purple-600">
                            <i data-feather="cpu" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <h3 class="font-medium">Together AI</h3>
                            <p class="text-xs text-stone-500">AI Recommendations</p>
                        </div>
                    </div>
                    <div id="status-ai" class="flex items-center gap-1.5">
                        <div class="w-2 h-2 rounded-full bg-stone-300 spin"></div>
                        <span class="text-xs text-stone-500">Checking</span>
                    </div>
                </div>
                <div class="text-xs text-stone-400" id="details-ai">-</div>
            </div>

            <!-- MealMe API -->
            <div class="bg-white rounded-xl border border-stone-200 p-5" id="card-mealme">
                <div class="flex items-start justify-between mb-4">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-lg bg-orange-100 flex items-center justify-center text-orange-600">
                            <i data-feather="shopping-bag" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <h3 class="font-medium">MealMe API</h3>
                            <p class="text-xs text-stone-500">Menus & Ordering</p>
                        </div>
                    </div>
                    <div id="status-mealme" class="flex items-center gap-1.5">
                        <div class="w-2 h-2 rounded-full bg-stone-300 spin"></div>
                        <span class="text-xs text-stone-500">Checking</span>
                    </div>
                </div>
                <div class="text-xs text-stone-400" id="details-mealme">-</div>
            </div>

        </div>

        <!-- Refresh Button -->
        <div class="text-center">
            <button onclick="checkAllServices()" class="inline-flex items-center gap-2 px-6 py-3 rounded-xl gradient-bg text-white text-sm font-medium hover:opacity-90 transition-all shadow-lg shadow-orange-500/20">
                <i data-feather="refresh-cw" class="w-4 h-4" id="refresh-icon"></i>
                Refresh Status
            </button>
        </div>

        <!-- Info -->
        <div class="mt-8 p-4 bg-stone-100 rounded-xl">
            <p class="text-xs text-stone-500 text-center">
                Status checks are performed client-side. For security, API keys are not exposed.
                This page checks public endpoints and general availability.
            </p>
        </div>

        <!-- Troubleshooting Section -->
        <div class="mt-8 bg-white rounded-2xl border border-stone-200 p-6">
            <h3 class="font-semibold text-lg mb-4 flex items-center gap-2">
                <i data-feather="tool" class="w-5 h-5 text-stone-500"></i>
                Troubleshooting Guide
            </h3>

            <div class="space-y-4">
                <!-- Supabase -->
                <details class="group">
                    <summary class="cursor-pointer flex items-center justify-between p-3 bg-stone-50 rounded-lg hover:bg-stone-100 transition-colors">
                        <span class="text-sm font-medium">Supabase Issues</span>
                        <i data-feather="chevron-down" class="w-4 h-4 text-stone-400 group-open:rotate-180 transition-transform"></i>
                    </summary>
                    <div class="mt-2 p-3 text-xs text-stone-600 space-y-2">
                        <p><strong>If showing "Down" but app works:</strong> This is likely a CORS false positive. The check can't read authenticated endpoints.</p>
                        <p><strong>Check Supabase Dashboard:</strong> <a href="https://supabase.com/dashboard" target="_blank" class="text-orange-500 hover:underline">supabase.com/dashboard</a></p>
                        <p><strong>Common fixes:</strong></p>
                        <ul class="list-disc ml-4 space-y-1">
                            <li>Check if project is paused (free tier pauses after inactivity)</li>
                            <li>Verify API keys in app .env file</li>
                            <li>Check RLS policies aren't blocking requests</li>
                            <li>Review Auth settings if login fails</li>
                        </ul>
                        <p><strong>Status page:</strong> <a href="https://status.supabase.com" target="_blank" class="text-orange-500 hover:underline">status.supabase.com</a></p>
                    </div>
                </details>

                <!-- Google Places -->
                <details class="group">
                    <summary class="cursor-pointer flex items-center justify-between p-3 bg-stone-50 rounded-lg hover:bg-stone-100 transition-colors">
                        <span class="text-sm font-medium">Google Places Issues</span>
                        <i data-feather="chevron-down" class="w-4 h-4 text-stone-400 group-open:rotate-180 transition-transform"></i>
                    </summary>
                    <div class="mt-2 p-3 text-xs text-stone-600 space-y-2">
                        <p><strong>Common fixes:</strong></p>
                        <ul class="list-disc ml-4 space-y-1">
                            <li>Check API key is valid and not expired</li>
                            <li>Verify billing is enabled on Google Cloud</li>
                            <li>Check quota limits haven't been exceeded</li>
                            <li>Ensure Places API is enabled in Google Cloud Console</li>
                        </ul>
                        <p><strong>Console:</strong> <a href="https://console.cloud.google.com/apis/credentials" target="_blank" class="text-orange-500 hover:underline">Google Cloud Console</a></p>
                    </div>
                </details>

                <!-- Together AI -->
                <details class="group">
                    <summary class="cursor-pointer flex items-center justify-between p-3 bg-stone-50 rounded-lg hover:bg-stone-100 transition-colors">
                        <span class="text-sm font-medium">Together AI Issues</span>
                        <i data-feather="chevron-down" class="w-4 h-4 text-stone-400 group-open:rotate-180 transition-transform"></i>
                    </summary>
                    <div class="mt-2 p-3 text-xs text-stone-600 space-y-2">
                        <p><strong>Common fixes:</strong></p>
                        <ul class="list-disc ml-4 space-y-1">
                            <li>Check API key is valid</li>
                            <li>Verify account has credits/balance</li>
                            <li>Check rate limits haven't been exceeded</li>
                            <li>Try a different model if one is unavailable</li>
                        </ul>
                        <p><strong>Dashboard:</strong> <a href="https://api.together.xyz" target="_blank" class="text-orange-500 hover:underline">Together AI Dashboard</a></p>
                    </div>
                </details>

                <!-- MealMe -->
                <details class="group">
                    <summary class="cursor-pointer flex items-center justify-between p-3 bg-stone-50 rounded-lg hover:bg-stone-100 transition-colors">
                        <span class="text-sm font-medium">MealMe API Issues</span>
                        <i data-feather="chevron-down" class="w-4 h-4 text-stone-400 group-open:rotate-180 transition-transform"></i>
                    </summary>
                    <div class="mt-2 p-3 text-xs text-stone-600 space-y-2">
                        <p><strong>Common fixes:</strong></p>
                        <ul class="list-disc ml-4 space-y-1">
                            <li>Check API key is valid</li>
                            <li>Verify subscription is active</li>
                            <li>Check rate limits</li>
                            <li>Contact MealMe support if issues persist</li>
                        </ul>
                        <p><strong>Docs:</strong> <a href="https://docs.mealme.ai" target="_blank" class="text-orange-500 hover:underline">MealMe API Docs</a></p>
                    </div>
                </details>

                <!-- General -->
                <details class="group">
                    <summary class="cursor-pointer flex items-center justify-between p-3 bg-stone-50 rounded-lg hover:bg-stone-100 transition-colors">
                        <span class="text-sm font-medium">General App Issues</span>
                        <i data-feather="chevron-down" class="w-4 h-4 text-stone-400 group-open:rotate-180 transition-transform"></i>
                    </summary>
                    <div class="mt-2 p-3 text-xs text-stone-600 space-y-2">
                        <p><strong>If all services show "Down":</strong></p>
                        <ul class="list-disc ml-4 space-y-1">
                            <li>Check your internet connection</li>
                            <li>Try refreshing the page</li>
                            <li>Clear browser cache</li>
                            <li>Check if ad blocker is interfering</li>
                        </ul>
                        <p><strong>App not working but services OK:</strong></p>
                        <ul class="list-disc ml-4 space-y-1">
                            <li>Check .env file has all required API keys</li>
                            <li>Rebuild the app after env changes</li>
                            <li>Check app logs for specific errors</li>
                        </ul>
                    </div>
                </details>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="border-t border-stone-200 mt-12 py-6">
        <div class="max-w-4xl mx-auto px-6 text-center text-xs text-stone-400">
            &copy; 2025 LunchNear.me. Admin Dashboard.
        </div>
    </footer>

    <script>
        feather.replace();

        // Service configurations
        const services = {
            supabase: {
                name: 'Supabase',
                url: 'https://lnhrppjwbtbqjuzuqbdb.supabase.co/rest/v1/',
                checkUrl: 'https://lnhrppjwbtbqjuzuqbdb.supabase.co/rest/v1/'
            },
            google: {
                name: 'Google Places',
                // We'll check if Google's API endpoint is reachable
                url: 'https://maps.googleapis.com/maps/api/place/nearbysearch/json'
            },
            ai: {
                name: 'Together AI',
                url: 'https://api.together.xyz/v1/models'
            },
            mealme: {
                name: 'MealMe API',
                url: 'https://api.mealme.ai'
            }
        };

        let serviceStatuses = {};

        function updateServiceStatus(serviceId, status, message) {
            const statusEl = document.getElementById(`status-${serviceId}`);
            const detailsEl = document.getElementById(`details-${serviceId}`);
            const cardEl = document.getElementById(`card-${serviceId}`);

            serviceStatuses[serviceId] = status;

            let dotClass = '';
            let statusText = '';
            let borderClass = '';

            switch(status) {
                case 'operational':
                    dotClass = 'bg-emerald-500 pulse-dot';
                    statusText = 'Operational';
                    borderClass = 'border-emerald-200';
                    break;
                case 'degraded':
                    dotClass = 'bg-yellow-500 pulse-dot';
                    statusText = 'Degraded';
                    borderClass = 'border-yellow-200';
                    break;
                case 'down':
                    dotClass = 'bg-red-500';
                    statusText = 'Down';
                    borderClass = 'border-red-200';
                    break;
                default:
                    dotClass = 'bg-stone-300 spin';
                    statusText = 'Checking';
                    borderClass = 'border-stone-200';
            }

            statusEl.innerHTML = `
                <div class="w-2 h-2 rounded-full ${dotClass}"></div>
                <span class="text-xs ${status === 'operational' ? 'text-emerald-600' : status === 'degraded' ? 'text-yellow-600' : status === 'down' ? 'text-red-600' : 'text-stone-500'}">${statusText}</span>
            `;

            detailsEl.textContent = message;
            cardEl.className = `bg-white rounded-xl border ${borderClass} p-5 transition-all`;

            updateOverallStatus();
        }

        function updateOverallStatus() {
            const overallEl = document.getElementById('overall-status');
            const statuses = Object.values(serviceStatuses);

            if (statuses.length < 4) return; // Not all checked yet

            const allOperational = statuses.every(s => s === 'operational');
            const anyDown = statuses.some(s => s === 'down');

            let dotClass, text, bgClass;

            if (allOperational) {
                dotClass = 'bg-emerald-500 pulse-dot';
                text = 'All Systems Operational';
                bgClass = 'bg-emerald-50 text-emerald-700';
            } else if (anyDown) {
                dotClass = 'bg-red-500';
                text = 'Some Systems Down';
                bgClass = 'bg-red-50 text-red-700';
            } else {
                dotClass = 'bg-yellow-500 pulse-dot';
                text = 'Partial Outage';
                bgClass = 'bg-yellow-50 text-yellow-700';
            }

            overallEl.className = `flex items-center gap-2 px-4 py-2 rounded-full ${bgClass}`;
            overallEl.innerHTML = `
                <div class="w-3 h-3 rounded-full ${dotClass}"></div>
                <span class="text-sm font-medium">${text}</span>
            `;
        }

        async function checkSupabase() {
            try {
                const start = Date.now();
                const response = await fetch('https://lnhrppjwbtbqjuzuqbdb.supabase.co/rest/v1/', {
                    method: 'HEAD',
                    mode: 'no-cors'
                });
                const latency = Date.now() - start;
                updateServiceStatus('supabase', 'operational', `Response time: ${latency}ms`);
            } catch (error) {
                updateServiceStatus('supabase', 'down', 'Unable to reach endpoint');
            }
        }

        async function checkGoogle() {
            try {
                const start = Date.now();
                // Check if Google Maps script can load
                await fetch('https://maps.googleapis.com/maps/api/js', {
                    method: 'HEAD',
                    mode: 'no-cors'
                });
                const latency = Date.now() - start;
                updateServiceStatus('google', 'operational', `Response time: ${latency}ms`);
            } catch (error) {
                updateServiceStatus('google', 'down', 'Unable to reach endpoint');
            }
        }

        async function checkAI() {
            try {
                const start = Date.now();
                await fetch('https://api.together.xyz/', {
                    method: 'HEAD',
                    mode: 'no-cors'
                });
                const latency = Date.now() - start;
                updateServiceStatus('ai', 'operational', `Response time: ${latency}ms`);
            } catch (error) {
                updateServiceStatus('ai', 'down', 'Unable to reach endpoint');
            }
        }

        async function checkMealMe() {
            try {
                const start = Date.now();
                await fetch('https://api.mealme.ai/', {
                    method: 'HEAD',
                    mode: 'no-cors'
                });
                const latency = Date.now() - start;
                updateServiceStatus('mealme', 'operational', `Response time: ${latency}ms`);
            } catch (error) {
                updateServiceStatus('mealme', 'down', 'Unable to reach endpoint');
            }
        }

        async function checkAllServices() {
            // Reset statuses
            serviceStatuses = {};

            // Show checking state
            ['supabase', 'google', 'ai', 'mealme'].forEach(id => {
                updateServiceStatus(id, 'checking', 'Checking...');
            });

            // Add spin to refresh button
            document.getElementById('refresh-icon').classList.add('spin');

            // Check all services
            await Promise.all([
                checkSupabase(),
                checkGoogle(),
                checkAI(),
                checkMealMe()
            ]);

            // Update last check time
            document.getElementById('last-check').textContent = new Date().toLocaleTimeString();

            // Remove spin from refresh button
            document.getElementById('refresh-icon').classList.remove('spin');
        }

        // Initial check on page load
        checkAllServices();

        // Auto-refresh every hour
        setInterval(checkAllServices, 3600000);
    </script>
</body>
</html>
