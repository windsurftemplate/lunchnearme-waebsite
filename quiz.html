<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Discover your lunch personality! Take this 2-minute quiz to find out if you're an Optimizer, Explorer, Foodie, or one of 5 other types.">

    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://lunchnear.me/quiz">
    <meta property="og:title" content="What's Your Lunch Personality? | LunchNear.me">
    <meta property="og:description" content="Take the 2-minute quiz to discover your lunch personality and find out how you really decide where to eat!">
    <meta property="og:image" content="https://lunchnear.me/og-quiz.png">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="What's Your Lunch Personality?">
    <meta name="twitter:description" content="Take the 2-minute quiz to discover your lunch personality!">
    <meta name="twitter:image" content="https://lunchnear.me/og-quiz.png">

    <title>What's Your Lunch Personality? | LunchNear.me</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽ¯</text></svg>">
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#B8860B",
                        "secondary": "#8B4513",
                        "brand-orange": "#F97316",
                        "brand-pink": "#EC4899",
                        "background-light": "#F5F5DC",
                        "background-dark": "#1c1917",
                        "surface-dark": "#292524",
                        "surface-light": "#ffffff"
                    },
                    fontFamily: {
                        "display": ["Plus Jakarta Sans", "sans-serif"],
                        "body": ["Inter", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "1rem",
                        "lg": "2rem",
                        "xl": "3rem",
                        "full": "9999px"
                    },
                }
            }
        }
    </script>
    <style>
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        @keyframes confetti {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-100px) rotate(720deg); opacity: 0; }
        }
        .confetti {
            animation: confetti 1s ease-out forwards;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark text-slate-800 dark:text-white font-body min-h-screen flex flex-col overflow-x-hidden transition-colors duration-300">

    <!-- Header -->
    <header class="w-full border-b border-black/5 dark:border-white/10 bg-white/80 dark:bg-background-dark/80 backdrop-blur-md sticky top-0 z-50">
        <div class="max-w-[1280px] mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <a href="index.html" class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-gradient-to-br from-brand-orange to-brand-pink rounded-lg flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"></path>
                            <path d="M7 2v20"></path>
                            <path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3zm0 0v7"></path>
                        </svg>
                    </div>
                    <span class="text-sm font-semibold tracking-tight"><span class="text-slate-900 dark:text-white">lunch</span><span class="bg-gradient-to-r from-brand-orange to-brand-pink bg-clip-text text-transparent">near.me</span></span>
                </a>
                <div class="hidden sm:flex items-center gap-4">
                    <a href="index.html" class="px-4 py-2 text-sm font-medium text-slate-600 dark:text-slate-300 hover:text-slate-900 dark:hover:text-white transition-colors">
                        Home
                    </a>
                    <a href="https://play.google.com/store/apps/details?id=com.lunchnear.me" target="_blank" class="flex items-center justify-center h-10 px-6 rounded-full bg-gradient-to-r from-brand-orange to-brand-pink text-white text-sm font-bold hover:opacity-90 transition-all shadow-md shadow-brand-orange/20">
                        Get the App
                    </a>
                </div>
                <button class="sm:hidden p-2 rounded-full hover:bg-black/5 dark:hover:bg-white/10">
                    <span class="material-icons-round">menu</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow flex flex-col items-center relative">
        <!-- Background Image -->
        <div class="absolute inset-0 z-0">
            <img alt="Delicious food spread" class="w-full h-full object-cover" src="https://lh3.googleusercontent.com/aida-public/AB6AXuBb4XcSiDNq8kU5j4BvkZ92Bqtf9akMvYbnB0c6_xk--ecSUD-JxmXp2UQVsJWpidNzRBmS_08JuA-lOZsL7fImnLYGHNxFqUhWIvXG_Y8E_aBMbOjsHJd2_DUZSGY3mZYUyoTxuBIDxQt26aGSHVWPndxwuxfn1PWM4n4PQXD1U7O-DonJr0Hk5SQKB4miMiIi7EKM_RESYBXurEJqZ41t0HmXEWqcVeIb-NgioIr0EQa-S69O3pcm-gd7h91w0z3zcAc4ts9-SQ">
            <div class="absolute inset-0 bg-black/40"></div>
        </div>

        <div class="w-full max-w-[1280px] px-4 sm:px-6 lg:px-8 py-8 md:py-12 flex flex-col gap-12 relative z-10 justify-center min-h-[calc(100vh-4rem)]">

            <!-- Quiz Content -->
            <div id="quiz-content">
                <!-- Hero Section (Start Screen) -->
                <section id="quiz-start" class="flex flex-col items-center justify-center text-center p-4">
                    <div class="max-w-xl mx-auto bg-white/90 backdrop-blur-sm rounded-3xl p-8 md:p-12 shadow-xl text-slate-800">
                        <p class="text-sm font-bold uppercase tracking-widest text-brand-orange mb-4 font-body">Personality Quiz</p>
                        <h1 class="text-4xl md:text-5xl lg:text-6xl font-display font-bold leading-tight tracking-tight text-slate-900 mb-6">
                            What's Your Lunch Personality?
                        </h1>
                        <p class="text-lg text-slate-700 leading-relaxed mb-8 font-body">
                            Discover your true dining persona with this insightful 2-minute journey. Are you an Optimizer, Explorer, or perhaps a Creature of Habit?
                        </p>
                        <div class="flex flex-wrap gap-6 justify-center mb-8 text-slate-600">
                            <div class="flex items-center gap-2 text-sm font-medium">
                                <span class="material-icons-round text-brand-orange">timer</span> 2 mins
                            </div>
                            <div class="flex items-center gap-2 text-sm font-medium">
                                <span class="material-icons-round text-brand-orange">help_outline</span> 7 Questions
                            </div>
                            <div class="flex items-center gap-2 text-sm font-medium">
                                <span class="material-icons-round text-brand-orange">psychology</span> 8 Types
                            </div>
                        </div>
                        <button onclick="startQuiz()" class="bg-gradient-to-r from-brand-orange to-brand-pink text-white font-bold text-lg px-10 py-4 rounded-full hover:opacity-90 transition-all shadow-lg shadow-brand-orange/30 hover:shadow-brand-orange/40 transform hover:-translate-y-1 flex items-center justify-center gap-2 mx-auto">
                            <span class="material-icons-round">play_arrow</span>
                            Start Quiz
                        </button>
                        <p class="text-xs text-slate-400 mt-6 font-body">No email required to see your results</p>
                    </div>
                </section>

                <!-- Quiz Card (Hidden initially) -->
                <section id="quiz-questions" class="max-w-3xl mx-auto w-full hidden">
                    <div id="question-card" class="bg-white/85 dark:bg-surface-dark/90 backdrop-blur-md rounded-3xl p-6 md:p-10 shadow-xl border border-black/5 dark:border-white/5 relative overflow-hidden transition-colors duration-300 text-slate-800 dark:text-white animate-fade-in">

                        <!-- Progress Bar -->
                        <div class="flex flex-col gap-4 mb-8">
                            <div class="flex justify-between items-end">
                                <span id="progress-text" class="text-sm font-bold uppercase tracking-wider text-slate-600 dark:text-slate-400 font-body">Question 1 of 7</span>
                                <span id="progress-percent" class="text-brand-pink text-xs font-bold bg-brand-pink/10 px-2 py-1 rounded-md">14%</span>
                            </div>
                            <div class="h-2 w-full bg-slate-200 dark:bg-black/40 rounded-full overflow-hidden">
                                <div id="progress-bar" class="h-full bg-gradient-to-r from-brand-orange to-brand-pink rounded-full shadow-[0_0_10px_rgba(249,115,22,0.5)] transition-all duration-300" style="width: 14%"></div>
                            </div>
                        </div>

                        <!-- Question -->
                        <div class="mb-8 md:mb-10 text-center relative z-10">
                            <div class="inline-flex items-center justify-center size-12 rounded-full bg-gradient-to-br from-brand-orange/10 to-brand-pink/10 text-brand-orange mb-4">
                                <span class="material-icons-round text-2xl">local_dining</span>
                            </div>
                            <h2 id="question-text" class="text-2xl md:text-3xl font-display font-bold leading-tight mb-2"></h2>
                            <p class="text-slate-600 dark:text-slate-400 text-sm font-body">Your authentic inclination will guide us.</p>
                        </div>

                        <!-- Options -->
                        <div id="options-container" class="grid grid-cols-1 gap-4 relative z-10"></div>

                        <!-- Navigation -->
                        <div class="flex justify-between items-center mt-8 pt-6 border-t border-slate-200 dark:border-white/5 relative z-10">
                            <div class="text-sm text-slate-400 flex items-center gap-2">
                                <span class="inline-block w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                                <span id="live-count">2,847</span> people took this quiz today
                            </div>
                        </div>

                        <!-- Decorative blurs -->
                        <div class="absolute top-0 right-0 w-64 h-64 bg-brand-orange/5 rounded-full blur-3xl pointer-events-none -translate-y-1/2 translate-x-1/2"></div>
                        <div class="absolute bottom-0 left-0 w-48 h-48 bg-brand-pink/5 rounded-full blur-3xl pointer-events-none translate-y-1/2 -translate-x-1/2"></div>
                    </div>
                </section>
            </div>

            <!-- Results (hidden initially) -->
            <div id="results-content" class="hidden max-w-3xl mx-auto w-full">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </main>

    <script>

        // Supabase Client (with fallback if SDK doesn't load)
        const SUPABASE_URL = 'https://ekuqmcouqchzrwnvnzkr.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVrdXFtY291cWNoenJ3bnZuemtyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4NzE5NDAsImV4cCI6MjA4MDQ0Nzk0MH0.T8AMvu_NPsIyQ5DFXuozphgChNGHi3jnuJm7JgAVdWk';
        let supabaseClient = null;
        try {
            if (window.supabase && window.supabase.createClient) {
                supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            }
        } catch (e) {
            console.warn('Supabase SDK not loaded, quiz will work without saving results');
        }

        // Current quiz result ID (set after submission)
        let currentResultId = null;

        // Quiz Data
        const questions = [
            {
                id: 'q1',
                question: "It's 11:45am. What's your first thought?",
                options: [
                    { text: "Already know where I'm going", points: { habit: 3, optimizer: 1 } },
                    { text: "Time to find somewhere new!", points: { explorer: 3, foodie: 1 } },
                    { text: "Let me check what's quick nearby", points: { optimizer: 3, budget: 1 } },
                    { text: "Who's free for lunch?", points: { social: 3, mood: 1 } }
                ]
            },
            {
                id: 'q2',
                question: "Your ideal lunch budget is:",
                options: [
                    { text: "Whatever gets me the best food", points: { foodie: 3, explorer: 1 } },
                    { text: "Under $12, always", points: { budget: 3, habit: 1 } },
                    { text: "Depends on the day and mood", points: { mood: 3, social: 1 } },
                    { text: "I meal prep, so basically $0", points: { health: 3, budget: 2 } }
                ]
            },
            {
                id: 'q3',
                question: "You're picking a spot for a group. You prioritize:",
                options: [
                    { text: "Everyone's dietary needs", points: { health: 2, social: 3 } },
                    { text: "Somewhere with great photos", points: { foodie: 3, explorer: 1 } },
                    { text: "Fast service, we're all busy", points: { optimizer: 3, budget: 1 } },
                    { text: "A place we haven't tried", points: { explorer: 3, mood: 1 } }
                ]
            },
            {
                id: 'q4',
                question: "Your go-to lunch order is:",
                options: [
                    { text: "The same thing every time", points: { habit: 3, optimizer: 2 } },
                    { text: "Whatever looks healthy", points: { health: 3, budget: 1 } },
                    { text: "Whatever I'm craving that day", points: { mood: 3, foodie: 1 } },
                    { text: "The most interesting thing on the menu", points: { explorer: 3, foodie: 2 } }
                ]
            },
            {
                id: 'q5',
                question: "How do you discover new lunch spots?",
                options: [
                    { text: "Friends' recommendations", points: { social: 3, habit: 1 } },
                    { text: "Instagram/TikTok food accounts", points: { foodie: 3, explorer: 2 } },
                    { text: "I stick to what I know", points: { habit: 3, budget: 1 } },
                    { text: "Walk around and see what's new", points: { explorer: 3, mood: 1 } }
                ]
            },
            {
                id: 'q6',
                question: "A coworker suggests trying a new place. You think:",
                options: [
                    { text: "Sure, if it's quick", points: { optimizer: 3, social: 1 } },
                    { text: "Only if it has good reviews", points: { foodie: 2, habit: 2 } },
                    { text: "Is it in my budget?", points: { budget: 3, health: 1 } },
                    { text: "Yes! Let's go!", points: { explorer: 3, social: 2 } }
                ]
            },
            {
                id: 'q7',
                question: "What frustrates you most about lunch?",
                options: [
                    { text: "Wasting time deciding", points: { optimizer: 3, habit: 2 } },
                    { text: "Eating the same thing again", points: { explorer: 3, mood: 1 } },
                    { text: "Spending too much", points: { budget: 3, health: 1 } },
                    { text: "Finding healthy options", points: { health: 3, foodie: 1 } },
                    { text: "Coordinating with others", points: { social: 2, optimizer: 2 } },
                    { text: "Nothing looking appetizing", points: { mood: 3, explorer: 1 } }
                ]
            }
        ];

        const personalities = {
            optimizer: {
                name: "The Optimizer",
                icon: "bolt",
                tagline: "Time is money, especially at lunch",
                description: "You're efficiency-focused and hate wasting time deciding where to eat. You'd rather spend 30 seconds picking the perfect spot than 30 minutes debating. You value speed, convenience, and getting back to what matters.",
                strengths: ["Quick decision maker", "Values efficiency", "Rarely regrets choices", "Great at time management"],
                weaknesses: ["May miss hidden gems", "Can seem impatient to others", "Sometimes sacrifices quality for speed"],
                appHook: "AI picks the perfect spot in 30 seconds",
                famousExamples: ["Elon Musk", "Mark Zuckerberg", "Tim Cook"],
                color: "#F97316",
                percentage: 23
            },
            explorer: {
                name: "The Explorer",
                icon: "explore",
                tagline: "Life's too short for the same lunch twice",
                description: "You're always seeking new spots and get bored eating at the same place twice. Every lunch is an adventure, and you love discovering hidden gems before they become popular.",
                strengths: ["Adventurous eater", "Always finds new spots", "Great recommendations", "Open-minded"],
                weaknesses: ["Decision paralysis with too many options", "May overlook reliable favorites", "Can be disappointed when spots don't live up to hype"],
                appHook: "Daily new recommendations you've never tried",
                famousExamples: ["Anthony Bourdain", "Guy Fieri", "Gordon Ramsay"],
                color: "#10B981",
                percentage: 18
            },
            habit: {
                name: "The Creature of Habit",
                icon: "home",
                tagline: "If it ain't broke, why try somewhere new?",
                description: "You've found your spots and you're sticking to them. Why risk a bad lunch when you know exactly what you're getting at your regulars? You value consistency and reliability.",
                strengths: ["Knows what you like", "Builds relationships with staff", "Never disappointed", "Efficient ordering"],
                weaknesses: ["May miss out on great new spots", "Can be inflexible in groups", "Routine might feel boring to others"],
                appHook: "Track favorites, discover similar vibes",
                famousExamples: ["Barack Obama", "Warren Buffett", "Steve Jobs"],
                color: "#6366F1",
                percentage: 15
            },
            social: {
                name: "The Social Luncher",
                icon: "group",
                tagline: "It's not about the food, it's about the people",
                description: "For you, lunch is about connection. The food is secondary to the company. You're the one organizing team lunches, remembering everyone's dietary restrictions, and making sure everyone's included.",
                strengths: ["Great at group coordination", "Remembers everyone's preferences", "Builds team morale", "Inclusive"],
                weaknesses: ["Struggles with solo decisions", "May prioritize group over personal preference", "Coordination can be exhausting"],
                appHook: "Group voting - never argue about where to go",
                famousExamples: ["Oprah Winfrey", "Ellen DeGeneres", "Jimmy Fallon"],
                color: "#EC4899",
                percentage: 14
            },
            budget: {
                name: "The Budget Boss",
                icon: "account_balance_wallet",
                tagline: "A great lunch doesn't have to break the bank",
                description: "You know the value of a dollar and refuse to overpay for lunch. You've found the best spots with the biggest portions at the lowest prices. Your colleagues think you're frugal, but you call it smart.",
                strengths: ["Financially savvy", "Finds hidden value spots", "Great at stretching a budget", "Never overpays"],
                weaknesses: ["May miss premium experiences", "Can seem cheap to others", "Price sometimes trumps quality"],
                appHook: "Filter by price, never overspend on lunch",
                famousExamples: ["Dave Ramsey", "Mark Cuban", "Suze Orman"],
                color: "#22C55E",
                percentage: 12
            },
            foodie: {
                name: "The Foodie",
                icon: "restaurant",
                tagline: "Life's too short for mediocre food",
                description: "You're all about quality. Instagram-worthy plates, artisanal ingredients, and chef-driven menus are your jam. You follow food blogs, have opinions about olive oil, and your camera roll is 70% food pics.",
                strengths: ["Appreciates quality", "Great taste in restaurants", "Knows the best spots", "Elevates team lunches"],
                weaknesses: ["Can be perceived as snobby", "Budget isn't always a priority", "Quick lunch isn't in the vocabulary"],
                appHook: "Curated picks with photos and reviews",
                famousExamples: ["Chrissy Teigen", "David Chang", "Padma Lakshmi"],
                color: "#F59E0B",
                percentage: 11
            },
            health: {
                name: "The Health Nut",
                icon: "eco",
                tagline: "You are what you eat",
                description: "Nutrition comes first. You read menus carefully, know your macros, and always ask about preparation methods. Your coworkers come to you for healthy recommendations.",
                strengths: ["Consistent healthy choices", "Knows nutritional values", "Great self-discipline", "Inspires others"],
                weaknesses: ["Can be perceived as picky", "Limited spontaneity", "May struggle with group choices"],
                appHook: "Filter by dietary needs instantly",
                famousExamples: ["Tom Brady", "Gwyneth Paltrow", "Jennifer Aniston"],
                color: "#84CC16",
                percentage: 5
            },
            mood: {
                name: "The Mood Eater",
                icon: "sentiment_satisfied",
                tagline: "What sounds good RIGHT NOW?",
                description: "Your lunch choice depends entirely on how you're feeling. Stressed? Comfort food. Energized? Something light. Celebrating? Treat yourself. You trust your gut (literally) and let your cravings guide you.",
                strengths: ["In tune with your body", "Flexible and spontaneous", "Always satisfied", "Embraces variety"],
                weaknesses: ["Hard to plan ahead", "Can frustrate group decisions", "May eat emotionally"],
                appHook: "Tell us your mood, we'll match the food",
                famousExamples: ["Lizzo", "Post Malone", "Mindy Kaling"],
                color: "#A855F7",
                percentage: 2
            }
        };

        // Quiz State
        let currentQuestion = 0;
        let answers = [];
        let scores = {
            optimizer: 0, explorer: 0, habit: 0, social: 0,
            budget: 0, foodie: 0, health: 0, mood: 0
        };

        // DOM Elements (initialized after DOM is ready)
        let progressBar, progressText, progressPercent, questionText, optionsContainer;
        let quizContent, resultsContent, quizStart, quizQuestions;

        // Initialize DOM references
        function initDOMElements() {
            progressBar = document.getElementById('progress-bar');
            progressText = document.getElementById('progress-text');
            progressPercent = document.getElementById('progress-percent');
            questionText = document.getElementById('question-text');
            optionsContainer = document.getElementById('options-container');
            quizContent = document.getElementById('quiz-content');
            resultsContent = document.getElementById('results-content');
            quizStart = document.getElementById('quiz-start');
            quizQuestions = document.getElementById('quiz-questions');
        }

        // Initialize - just update live count, wait for user to start
        function init() {
            updateLiveCount();
        }

        // Start the quiz
        function startQuiz() {
            const start = document.getElementById('quiz-start');
            const questions = document.getElementById('quiz-questions');
            if (start && questions) {
                start.classList.add('hidden');
                questions.classList.remove('hidden');
                if (!progressBar) initDOMElements();
                renderQuestion();
            }
        }

        // Update live count randomly
        function updateLiveCount() {
            const baseCount = 2847;
            const variation = Math.floor(Math.random() * 100) - 50;
            document.getElementById('live-count').textContent = (baseCount + variation).toLocaleString();
        }

        // Render current question
        function renderQuestion() {
            const q = questions[currentQuestion];
            const progress = ((currentQuestion + 1) / questions.length) * 100;

            progressBar.style.width = `${progress}%`;
            progressText.textContent = `Question ${currentQuestion + 1} of ${questions.length}`;
            progressPercent.textContent = `${Math.round(progress)}%`;

            questionText.textContent = q.question;

            const letters = ['A', 'B', 'C', 'D', 'E', 'F'];
            optionsContainer.innerHTML = q.options.map((opt, i) => `
                <button onclick="selectOption(${i})" class="group relative flex items-center p-4 rounded-2xl border-2 border-slate-200 dark:border-white/10 hover:border-brand-orange dark:hover:border-brand-orange bg-white/70 dark:bg-black/20 hover:bg-brand-orange/5 transition-all duration-200 text-left w-full outline-none focus:ring-2 focus:ring-brand-orange focus:ring-offset-2 dark:focus:ring-offset-background-dark">
                    <div class="flex items-center justify-center size-10 rounded-full bg-slate-100 dark:bg-white/5 text-slate-500 group-hover:bg-gradient-to-br group-hover:from-brand-orange group-hover:to-brand-pink group-hover:text-white transition-all mr-4 flex-shrink-0 font-display">
                        <span class="font-bold">${letters[i]}</span>
                    </div>
                    <span class="flex-grow font-body font-medium text-lg">${opt.text}</span>
                    <span class="material-icons-round text-slate-300 dark:text-slate-600 group-hover:text-brand-pink opacity-0 group-hover:opacity-100 transition-all transform translate-x-[-10px] group-hover:translate-x-0">arrow_forward</span>
                </button>
            `).join('');
        }

        // Handle option selection
        function selectOption(index) {
            const q = questions[currentQuestion];
            const option = q.options[index];

            // Add points
            Object.entries(option.points).forEach(([type, pts]) => {
                scores[type] += pts;
            });

            answers.push(option);

            // Visual feedback
            const buttons = optionsContainer.querySelectorAll('button');
            buttons[index].classList.add('border-brand-orange', 'bg-brand-orange/10');
            buttons[index].querySelector('.size-10').classList.add('bg-gradient-to-br', 'from-brand-orange', 'to-brand-pink', 'text-white');

            // Disable all buttons
            buttons.forEach(btn => btn.disabled = true);

            // Move to next question or show results
            setTimeout(() => {
                if (currentQuestion < questions.length - 1) {
                    currentQuestion++;
                    document.getElementById('question-card').classList.remove('animate-fade-in');
                    setTimeout(() => {
                        renderQuestion();
                        document.getElementById('question-card').classList.add('animate-fade-in');
                    }, 150);
                } else {
                    showResults();
                }
            }, 400);
        }

        // Calculate and show results
        async function showResults() {
            // Find highest scoring personality
            const maxScore = Math.max(...Object.values(scores));
            const result = Object.entries(scores).find(([, score]) => score === maxScore)[0];
            const personality = personalities[result];

            // Get UTM parameters from URL
            const urlParams = new URLSearchParams(window.location.search);
            const source = urlParams.get('utm_source');
            const medium = urlParams.get('utm_medium');
            const campaign = urlParams.get('utm_campaign');
            const referrerCode = urlParams.get('ref');

            // Save to Supabase (if available)
            if (supabaseClient) {
                try {
                    const { data, error } = await supabaseClient.rpc('submit_quiz_result', {
                        p_personality_type: result,
                        p_answers: answers.map((a, i) => ({ question: questions[i].id, answer: a.text })),
                        p_scores: scores,
                        p_source: source,
                        p_medium: medium,
                        p_campaign: campaign,
                        p_referrer_code: referrerCode,
                        p_user_agent: navigator.userAgent
                    });

                    if (error) {
                        console.error('Error saving quiz result:', error);
                    } else {
                        currentResultId = data;
                        console.log('Quiz result saved:', currentResultId);
                    }
                } catch (err) {
                    console.error('Failed to save quiz result:', err);
                }
            }

            // Hide quiz, show results
            quizContent.classList.add('hidden');
            resultsContent.classList.remove('hidden');

            // Update page metadata for sharing
            document.title = `I'm a ${personality.name}! | Lunch Personality Quiz`;

            resultsContent.innerHTML = `
                <div class="animate-fade-in">
                    <!-- Confetti placeholder -->
                    <div class="absolute top-0 left-0 w-full pointer-events-none overflow-hidden h-32">
                        <div class="confetti absolute left-1/4 w-3 h-3 bg-brand-orange rounded"></div>
                        <div class="confetti absolute left-1/2 w-2 h-2 bg-brand-pink rounded" style="animation-delay: 0.1s"></div>
                        <div class="confetti absolute left-3/4 w-3 h-3 bg-yellow-400 rounded" style="animation-delay: 0.2s"></div>
                    </div>

                    <!-- Result Header -->
                    <div class="bg-white/85 dark:bg-surface-dark/90 backdrop-blur-md rounded-3xl p-6 md:p-10 shadow-xl border border-black/5 dark:border-white/5 relative overflow-hidden mb-6 text-center">
                        <p class="text-lg text-slate-500 dark:text-slate-400 mb-4 font-body">Your Lunch Personality is...</p>
                        <div class="w-24 h-24 rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-lg" style="background: ${personality.color}20; color: ${personality.color}">
                            <span class="material-icons-round text-5xl">${personality.icon}</span>
                        </div>
                        <h1 class="text-4xl font-bold text-slate-900 dark:text-white mb-2 font-display">${personality.name}</h1>
                        <p class="text-xl font-medium italic mb-2" style="color: ${personality.color}">"${personality.tagline}"</p>
                        <p class="text-sm text-slate-400">${personality.percentage}% of quiz takers share this personality</p>

                        <div class="absolute top-0 right-0 w-64 h-64 bg-brand-orange/5 rounded-full blur-3xl pointer-events-none -translate-y-1/2 translate-x-1/2"></div>
                        <div class="absolute bottom-0 left-0 w-48 h-48 bg-brand-pink/5 rounded-full blur-3xl pointer-events-none translate-y-1/2 -translate-x-1/2"></div>
                    </div>

                    <!-- Email Capture -->
                    <div class="bg-white/85 dark:bg-surface-dark/90 backdrop-blur-md rounded-3xl p-6 md:p-8 shadow-xl border border-black/5 dark:border-white/5 mb-6">
                        <div class="text-center">
                            <h3 class="text-xl font-bold text-slate-900 dark:text-white mb-2 font-display">Get Your Full Lunch Profile</h3>
                            <p class="text-slate-600 dark:text-slate-400 mb-4 font-body">Weekly tips tailored for your personality + early access to new features</p>
                            <form onsubmit="handleEmailSubmit(event, '${result}'); return false;" class="max-w-md mx-auto">
                                <div class="flex flex-col sm:flex-row gap-3">
                                    <input type="email" id="email-input" placeholder="Enter your email" required class="flex-1 px-4 py-3 border-2 border-slate-200 dark:border-white/10 rounded-full bg-white dark:bg-black/20 focus:outline-none focus:border-brand-orange transition-colors font-body">
                                    <button type="submit" class="bg-gradient-to-r from-brand-orange to-brand-pink text-white font-semibold px-6 py-3 rounded-full hover:opacity-90 transition-colors shadow-lg shadow-brand-orange/20">Get My Tips</button>
                                </div>
                            </form>
                            <p class="text-xs text-slate-400 mt-3 font-body">No spam, unsubscribe anytime.</p>
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="bg-white/85 dark:bg-surface-dark/90 backdrop-blur-md rounded-3xl p-6 md:p-10 shadow-xl border border-black/5 dark:border-white/5 mb-6">
                        <p class="text-lg text-slate-700 dark:text-slate-300 leading-relaxed mb-8 font-body">${personality.description}</p>

                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h3 class="font-semibold text-slate-900 dark:text-white mb-3 flex items-center gap-2 font-display">
                                    <span class="material-icons-round text-green-500">check_circle</span> Your Strengths
                                </h3>
                                <ul class="space-y-2">
                                    ${personality.strengths.map(s => `<li class="text-slate-600 dark:text-slate-400 flex items-start gap-2 font-body"><span class="text-green-500 mt-1">â€¢</span>${s}</li>`).join('')}
                                </ul>
                            </div>
                            <div>
                                <h3 class="font-semibold text-slate-900 dark:text-white mb-3 flex items-center gap-2 font-display">
                                    <span class="material-icons-round text-brand-orange">warning</span> Watch Out For
                                </h3>
                                <ul class="space-y-2">
                                    ${personality.weaknesses.map(w => `<li class="text-slate-600 dark:text-slate-400 flex items-start gap-2 font-body"><span class="text-brand-orange mt-1">â€¢</span>${w}</li>`).join('')}
                                </ul>
                            </div>
                        </div>

                        <div class="mt-8 pt-6 border-t border-slate-200 dark:border-white/10">
                            <h3 class="font-semibold text-slate-900 dark:text-white mb-3 font-display">Famous ${personality.name}s</h3>
                            <div class="flex flex-wrap gap-2">
                                ${personality.famousExamples.map(ex => `<span class="px-3 py-1 bg-slate-100 dark:bg-white/10 rounded-full text-sm text-slate-700 dark:text-slate-300 font-body">${ex}</span>`).join('')}
                            </div>
                        </div>
                    </div>

                    <!-- App CTA -->
                    <div class="bg-gradient-to-r from-brand-orange to-brand-pink rounded-3xl p-6 md:p-8 text-white mb-6 relative overflow-hidden">
                        <h2 class="text-2xl font-bold mb-2 font-display">LunchNear.me was built for ${personality.name}s like you</h2>
                        <p class="text-white/90 mb-4 font-body">${personality.appHook}</p>
                        <div class="flex flex-col sm:flex-row gap-3">
                            <a href="https://play.google.com/store/apps/details?id=com.lunchnear.me" target="_blank" class="flex items-center justify-center gap-2 bg-white text-slate-900 font-semibold py-3 px-6 rounded-full hover:bg-slate-100 transition-colors">
                                <span class="material-icons-round">android</span>
                                Download for Android
                            </a>
                            <a href="index.html#download" class="flex items-center justify-center gap-2 bg-white/20 text-white font-semibold py-3 px-6 rounded-full hover:bg-white/30 transition-colors">
                                <span class="material-icons-round">phone_iphone</span>
                                iOS Coming Soon
                            </a>
                        </div>
                    </div>

                    <!-- Share -->
                    <div class="bg-white/85 dark:bg-surface-dark/90 backdrop-blur-md rounded-3xl p-6 md:p-8 shadow-xl border border-black/5 dark:border-white/5 mb-6">
                        <h2 class="text-xl font-bold text-slate-900 dark:text-white mb-4 text-center font-display">Share Your Result</h2>
                        <div class="flex flex-col sm:flex-row items-center justify-center gap-3">
                            <button onclick="shareTwitter('${result}')" class="flex items-center gap-2 bg-black text-white px-5 py-3 rounded-full hover:bg-slate-800 transition-colors w-full sm:w-auto justify-center font-body">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                                Share on X
                            </button>
                            <button onclick="shareLinkedIn('${result}')" class="flex items-center gap-2 bg-[#0A66C2] text-white px-5 py-3 rounded-full hover:bg-[#004182] transition-colors w-full sm:w-auto justify-center font-body">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                                Share on LinkedIn
                            </button>
                            <button onclick="copyLink('${result}')" id="copy-btn" class="flex items-center gap-2 bg-slate-100 dark:bg-white/10 text-slate-700 dark:text-slate-300 px-5 py-3 rounded-full hover:bg-slate-200 dark:hover:bg-white/20 transition-colors w-full sm:w-auto justify-center font-body">
                                <span class="material-icons-round">content_copy</span>
                                Copy Link
                            </button>
                        </div>
                    </div>

                    <!-- All Personalities -->
                    <div class="bg-white/85 dark:bg-surface-dark/90 backdrop-blur-md rounded-3xl p-6 md:p-8 shadow-xl border border-black/5 dark:border-white/5 mb-6">
                        <h2 class="text-xl font-bold text-slate-900 dark:text-white mb-6 text-center font-display">Compare With Friends</h2>
                        <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                            ${Object.entries(personalities).map(([key, p]) => `
                                <button onclick="showPersonality('${key}')" class="p-4 rounded-2xl text-center transition-all ${key === result ? 'bg-brand-orange/10 border-2 border-brand-orange' : 'bg-white/50 dark:bg-black/20 border-2 border-slate-100 dark:border-white/5 hover:border-brand-orange'} group">
                                    <div class="w-12 h-12 rounded-xl mx-auto mb-2 flex items-center justify-center transition-transform group-hover:scale-110" style="background: ${p.color}20; color: ${p.color}">
                                        <span class="material-icons-round text-2xl">${p.icon}</span>
                                    </div>
                                    <span class="text-sm font-medium text-slate-700 dark:text-slate-300 block font-body">${p.name}</span>
                                    <span class="text-xs text-slate-400 block">${p.percentage}%</span>
                                </button>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Retake -->
                    <div class="text-center">
                        <button onclick="retakeQuiz()" class="text-brand-orange hover:text-brand-pink font-medium inline-flex items-center gap-2 transition-colors font-body">
                            <span class="material-icons-round">refresh</span>
                            Retake the Quiz
                        </button>
                    </div>
                </div>
            `;
        }

        // Share functions with tracking
        async function trackShare(platform, type) {
            if (!currentResultId || !supabaseClient) return null;

            try {
                const { data, error } = await supabaseClient.rpc('create_quiz_share', {
                    p_result_id: currentResultId,
                    p_platform: platform
                });

                if (error) {
                    console.error('Error tracking share:', error);
                    return null;
                }
                return data; // Returns referral code
            } catch (err) {
                console.error('Failed to track share:', err);
                return null;
            }
        }

        async function shareTwitter(type) {
            const p = personalities[type];
            const refCode = await trackShare('twitter', type);
            const text = `I'm a ${p.name}! What's YOUR lunch personality? Take the quiz:`;
            const url = refCode
                ? `https://lunchnear.me/quiz.html?ref=${refCode}`
                : `https://lunchnear.me/quiz.html?result=${type}`;
            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`, '_blank', 'width=550,height=420');
        }

        async function shareLinkedIn(type) {
            const refCode = await trackShare('linkedin', type);
            const url = refCode
                ? `https://lunchnear.me/quiz.html?ref=${refCode}`
                : `https://lunchnear.me/quiz.html?result=${type}`;
            window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}`, '_blank', 'width=550,height=420');
        }

        async function copyLink(type) {
            const refCode = await trackShare('copy', type);
            const url = refCode
                ? `https://lunchnear.me/quiz.html?ref=${refCode}`
                : `https://lunchnear.me/quiz.html?result=${type}`;
            navigator.clipboard.writeText(url).then(() => {
                const btn = document.getElementById('copy-btn');
                btn.innerHTML = '<span class="material-icons-round">check</span> Copied!';
                btn.classList.add('bg-green-500', 'text-white');
                btn.classList.remove('bg-slate-100', 'text-slate-700', 'dark:bg-white/10', 'dark:text-slate-300');
                setTimeout(() => {
                    btn.innerHTML = '<span class="material-icons-round">content_copy</span> Copy Link';
                    btn.classList.remove('bg-green-500', 'text-white');
                    btn.classList.add('bg-slate-100', 'text-slate-700', 'dark:bg-white/10', 'dark:text-slate-300');
                }, 2000);
            });
        }

        async function handleEmailSubmit(e, type) {
            e.preventDefault();
            const emailInput = document.getElementById('email-input');
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const email = emailInput.value;

            if (!email || !email.includes('@')) {
                alert('Please enter a valid email address');
                return;
            }

            // Disable form while submitting
            emailInput.disabled = true;
            submitBtn.disabled = true;
            submitBtn.textContent = 'Saving...';

            try {
                if (supabaseClient && currentResultId) {
                    // Update the quiz result with email
                    const { error } = await supabaseClient.rpc('capture_quiz_email', {
                        p_result_id: currentResultId,
                        p_email: email
                    });

                    if (error) {
                        console.error('Error saving email:', error);
                        alert('Something went wrong. Please try again.');
                        emailInput.disabled = false;
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'Get My Tips';
                        return;
                    }
                } else if (supabaseClient) {
                    // Fallback: insert directly if no result ID
                    const { error } = await supabaseClient.from('quiz_results').insert({
                        email: email,
                        personality_type: type,
                        answers: [],
                        scores: {}
                    });

                    if (error) {
                        console.error('Error saving email:', error);
                        alert('Something went wrong. Please try again.');
                        emailInput.disabled = false;
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'Get My Tips';
                        return;
                    }
                }
                // If no supabase, just show success (email won't be saved but UX continues)

                // Show success state
                e.target.innerHTML = `
                    <div class="text-center py-4">
                        <span class="material-icons-round text-5xl text-brand-orange mb-3">emoji_events</span>
                        <h3 class="text-xl font-bold text-slate-900 dark:text-white mb-2 font-display">You're In!</h3>
                        <p class="text-slate-600 dark:text-slate-400 font-body">Check your inbox for your personalized lunch tips and full personality breakdown.</p>
                    </div>
                `;
            } catch (err) {
                console.error('Failed to save email:', err);
                alert('Something went wrong. Please try again.');
                emailInput.disabled = false;
                submitBtn.disabled = false;
                submitBtn.textContent = 'Get My Tips';
            }
        }

        function showPersonality(type) {
            // For now, just highlight - could expand to show that personality's details
            console.log('Show personality:', type);
        }

        function retakeQuiz() {
            currentQuestion = 0;
            answers = [];
            scores = { optimizer: 0, explorer: 0, habit: 0, social: 0, budget: 0, foodie: 0, health: 0, mood: 0 };
            currentResultId = null;
            quizContent.classList.remove('hidden');
            resultsContent.classList.add('hidden');
            quizStart.classList.remove('hidden');
            quizQuestions.classList.add('hidden');
        }

        // Check if coming from a shared result link
        async function checkSharedResult() {
            const params = new URLSearchParams(window.location.search);
            const result = params.get('result');
            const refCode = params.get('ref');

            // Track referral click (if supabase available)
            if (refCode && supabaseClient) {
                try {
                    await supabaseClient.rpc('increment_share_click', {
                        p_referral_code: refCode
                    });
                    console.log('Referral click tracked:', refCode);
                } catch (err) {
                    console.error('Failed to track referral:', err);
                }
            }

            if (result && personalities[result]) {
                // Show that personality's result directly
                quizContent.classList.add('hidden');
                resultsContent.classList.remove('hidden');
                const personality = personalities[result];
                document.title = `I'm a ${personality.name}! | Lunch Personality Quiz`;
                // Populate results (simplified version)
                resultsContent.innerHTML = `
                    <div class="bg-white/85 dark:bg-surface-dark/90 backdrop-blur-md rounded-3xl p-6 md:p-10 shadow-xl border border-black/5 dark:border-white/5 relative overflow-hidden text-center">
                        <p class="text-lg text-slate-500 dark:text-slate-400 mb-4 font-body">This person's Lunch Personality is...</p>
                        <div class="w-24 h-24 rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-lg" style="background: ${personality.color}20; color: ${personality.color}">
                            <span class="material-icons-round text-5xl">${personality.icon}</span>
                        </div>
                        <h1 class="text-4xl font-bold text-slate-900 dark:text-white mb-2 font-display">${personality.name}</h1>
                        <p class="text-xl font-medium italic mb-6" style="color: ${personality.color}">"${personality.tagline}"</p>

                        <p class="text-slate-600 dark:text-slate-400 mb-6 font-body">Want to discover YOUR lunch personality?</p>
                        <button onclick="retakeQuiz()" class="bg-gradient-to-r from-brand-orange to-brand-pink text-white font-semibold px-8 py-4 rounded-full hover:opacity-90 transition-colors shadow-lg shadow-brand-orange/20">
                            Take the Quiz
                        </button>

                        <div class="absolute top-0 right-0 w-64 h-64 bg-brand-orange/5 rounded-full blur-3xl pointer-events-none -translate-y-1/2 translate-x-1/2"></div>
                        <div class="absolute bottom-0 left-0 w-48 h-48 bg-brand-pink/5 rounded-full blur-3xl pointer-events-none translate-y-1/2 -translate-x-1/2"></div>
                    </div>
                `;
                return true;
            }
            return false;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                initDOMElements();
                const isSharedResult = await checkSharedResult();
                if (!isSharedResult) {
                    init();
                }
            } catch (err) {
                console.error('Initialization error:', err);
            }
        });
    </script>
</body>
</html>
